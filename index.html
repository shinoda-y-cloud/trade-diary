<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ãƒˆãƒ¬ãƒ¼ãƒ‰æ—¥è¨˜ï¼ˆé¸æŠå¼ãƒ»30ç§’ï¼‰</title>
  <style>
    :root{
      --bg:#0b1020; --card:#111a33; --card2:#0f1730; --text:#e9eefc; --muted:#9fb0dd;
      --line:#22305c; --accent:#67d3ff; --good:#49e3a2; --bad:#ff6b6b; --warn:#ffd166;
    }
    *{box-sizing:border-box}

    <!-- ğŸ” ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯ -->
<div id="lock-screen" style="
  position:fixed;
  inset:0;
  background:#0b1020;
  color:#e9eefc;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
">
  <div style="text-align:center; max-width:320px;">
    <h2 style="margin-bottom:16px;">ãƒˆãƒ¬ãƒ¼ãƒ‰æ—¥è¨˜</h2>
    <p style="font-size:13px; opacity:0.8;">ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    <input
      id="passcode-input"
      type="password"
      placeholder="Passcode"
      style="
        width:100%;
        padding:10px;
        margin-top:12px;
        border-radius:6px;
        border:none;
        font-size:16px;
      "
    />
    <button
      onclick="unlockDiary()"
      style="
        width:100%;
        margin-top:12px;
        padding:10px;
        border-radius:6px;
        border:none;
        background:#6d7cff;
        color:white;
        font-size:14px;
        cursor:pointer;
      "
    >
      é–‹ã
    </button>
    <p id="lock-error" style="color:#ff6b6b; font-size:12px; margin-top:10px; display:none;">
      ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™
    </p>
  </div>
</div>

<script>
  const CORRECT_PASSCODE = "kyoto.3594"; // â† å¥½ããªã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´

  function unlockDiary() {
    const input = document.getElementById("passcode-input").value;
    if (input === CORRECT_PASSCODE) {
      localStorage.setItem("tradeDiaryUnlocked", "true");
      document.getElementById("lock-screen").style.display = "none";
    } else {
      document.getElementById("lock-error").style.display = "block";
    }
  }

  window.addEventListener("DOMContentLoaded", () => {
    if (localStorage.getItem("tradeDiaryUnlocked") === "true") {
      document.getElementById("lock-screen").style.display = "none";
    }
  });
</script>

    
    body{
      margin:0; font-family:system-ui,-apple-system,"Hiragino Sans","Noto Sans JP",sans-serif;
      background:radial-gradient(1200px 700px at 20% -10%, #17306b 0%, transparent 55%),
                 radial-gradient(900px 600px at 110% 20%, #2b145b 0%, transparent 55%),
                 var(--bg);
      color:var(--text);
    }
    header{padding:18px 16px 10px; max-width:1100px; margin:0 auto;}
    h1{font-size:18px; margin:0 0 6px;}
    .sub{color:var(--muted); font-size:12px; line-height:1.5;}
    main{max-width:1100px; margin:0 auto; padding:0 16px 24px;}
    .grid{display:grid; grid-template-columns: 1fr; gap:12px;}
    @media (min-width: 980px){ .grid{grid-template-columns: 1.05fr .95fr;} }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.08);
      box-shadow:0 12px 40px rgba(0,0,0,0.35);
      border-radius:16px;
      overflow:hidden;
    }
    .card .hd{
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,0.08);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:rgba(17,26,51,0.45);
    }
    .card .bd{padding:14px;}
    .pill{font-size:12px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,0.12); color:var(--muted);}
    .row{display:grid; grid-template-columns: 1fr; gap:10px; margin-bottom:12px;}
    @media (min-width: 640px){ .row{grid-template-columns: 1fr 1fr;} }
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px;}
    select, input[type="date"], input[type="number"], input[type="text"], textarea{
      width:100%;
      background:rgba(7,10,20,0.55);
      border:1px solid rgba(255,255,255,0.12);
      color:var(--text);
      border-radius:12px;
      padding:10px 10px;
      outline:none;
    }
    textarea{min-height:64px; resize:vertical;}
    .actions{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px;}
    button{
      border:none; cursor:pointer;
      padding:10px 12px; border-radius:12px;
      color:#06101a; background:var(--accent);
      font-weight:700;
    }
    button.secondary{background:transparent; color:var(--text); border:1px solid rgba(255,255,255,0.18);}
    button.danger{background:var(--bad); color:#1a0606;}
    button.small{padding:7px 10px; border-radius:10px; font-size:12px;}
    .kpi{
      display:grid; grid-template-columns: repeat(2,1fr); gap:10px;
    }
    @media (min-width: 640px){ .kpi{grid-template-columns: repeat(4,1fr);} }
    .kpi .box{
      background:rgba(7,10,20,0.45);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px; padding:10px;
    }
    .kpi .t{font-size:11px; color:var(--muted);}
    .kpi .v{font-size:18px; font-weight:800; margin-top:4px;}
    .v.good{color:var(--good)}
    .v.bad{color:var(--bad)}
    .tbl{width:100%; border-collapse:separate; border-spacing:0 8px;}
    .tbl th{font-size:11px; color:var(--muted); font-weight:600; text-align:left; padding:0 8px;}
    .tbl td{
      background:rgba(7,10,20,0.45);
      border:1px solid rgba(255,255,255,0.08);
      padding:8px; border-radius:12px;
      vertical-align:top; font-size:12px;
    }
    .mini{font-size:11px; color:var(--muted); line-height:1.45;}
    .tag{
      display:inline-block; font-size:11px; padding:3px 8px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.16); color:var(--muted); margin-right:6px;
    }
    .tag.good{border-color: rgba(73,227,162,0.45); color: var(--good);}
    .tag.bad{border-color: rgba(255,107,107,0.45); color: var(--bad);}
    .tag.warn{border-color: rgba(255,209,102,0.45); color: var(--warn);}
    .right{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; align-items:center;}
    .hint{margin-top:10px; color:var(--muted); font-size:12px; line-height:1.5;}

    /* modal */
    .modal-bg{
      position:fixed; inset:0;
      background:rgba(0,0,0,0.55);
      display:none; align-items:center; justify-content:center;
      padding:16px;
    }
    .modal{
      width:min(820px, 100%);
      background:rgba(17,26,51,0.92);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:16px;
      box-shadow:0 24px 80px rgba(0,0,0,0.55);
      overflow:hidden;
    }
    .modal .hd{
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,0.10);
      display:flex; align-items:center; justify-content:space-between;
    }
    .modal .bd{padding:14px;}
    .status{
      font-size:12px; color:var(--muted);
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .dot{width:8px; height:8px; border-radius:99px; background:rgba(255,255,255,0.25);}
    .dot.ok{background:var(--good);}
    .dot.ng{background:var(--bad);}
  </style>
</head>

<body>
<header>
  <h1>ãƒˆãƒ¬ãƒ¼ãƒ‰æ—¥è¨˜ï¼ˆé¸æŠå¼ãƒ»30ç§’ï¼‰</h1>
  <div class="sub">
    å…¥åŠ›ã¯åŸºæœ¬ã€Œé¸æŠã€ã ã‘ã€‚ä¿å­˜ã¯ãƒ­ãƒ¼ã‚«ãƒ«ï¼GitHubã¸1ã‚¯ãƒªãƒƒã‚¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒã€‚è¤‡æ•°ç«¯æœ«ã¯ <b>ãƒãƒ¼ã‚¸ï¼ˆupdatedAtå„ªå…ˆï¼‰</b> ã§è¡çªå›é¿ã€‚
  </div>
</header>

<main class="grid">

  <!-- å…¥åŠ› -->
  <section class="card">
    <div class="hd">
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <div class="pill">ä»Šæ—¥ã®è¨˜éŒ²</div>
        <div class="pill" id="todayLabel">â€”</div>
        <div class="pill" id="ghLabel">GitHub: æœªè¨­å®š</div>
      </div>
      <div class="right">
        <button class="secondary small" id="btnGitHub" type="button">GitHubè¨­å®š</button>
        <button class="secondary small" id="btnBackup" type="button">GitHubã¸ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
        <button class="secondary small" id="btnRestore" type="button">GitHubã‹ã‚‰å¾©å…ƒ</button>
        <button class="secondary" id="btnLoadToday" type="button">ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­è¾¼</button>
        <button class="secondary" id="btnResetForm" type="button">ãƒ•ã‚©ãƒ¼ãƒ åˆæœŸåŒ–</button>
      </div>
    </div>

    <div class="bd">
      <div class="row">
        <div>
          <label>æ—¥ä»˜</label>
          <input type="date" id="date" />
        </div>
        <div>
          <label>ç›¸å ´ã‚¿ã‚¤ãƒ—ï¼ˆä½“æ„Ÿï¼‰</label>
          <select id="marketType">
            <option value="ä¸æ˜">ä¸æ˜</option>
            <option value="ãƒˆãƒ¬ãƒ³ãƒ‰">ãƒˆãƒ¬ãƒ³ãƒ‰</option>
            <option value="ãƒ¬ãƒ³ã‚¸">ãƒ¬ãƒ³ã‚¸</option>
            <option value="è’ã„">è’ã„ï¼ˆä¹±é«˜ä¸‹ï¼‰</option>
            <option value="è–„ã„">è–„ã„ï¼ˆå€¤å‹•ãæ‚ªã„ï¼‰</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>æœ¬æ—¥ã®çµæœ</label>
          <select id="result">
            <option value="æœªå…¥åŠ›">æœªå…¥åŠ›</option>
            <option value="å‹ã¡">å‹ã¡</option>
            <option value="è² ã‘">è² ã‘</option>
            <option value="ãƒˆãƒ³ãƒˆãƒ³">ãƒˆãƒ³ãƒˆãƒ³</option>
            <option value="ãƒãƒ¼ãƒˆãƒ¬">ãƒãƒ¼ãƒˆãƒ¬</option>
          </select>
        </div>
        <div>
          <label>æç›Šï¼ˆå††ï¼‰ â€»ã ã„ãŸã„ã§OKï¼ˆæœªå…¥åŠ›å¯ï¼‰</label>
          <input type="number" id="pnl" placeholder="ä¾‹ï¼š-4000 / 6500" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>ä¸»æˆ¦éŠ˜æŸ„ï¼ˆè¤‡æ•°å¯ï¼‰</label>
          <select id="tickers" multiple size="6">
            <option value="8031 ä¸‰äº•ç‰©ç”£">8031 ä¸‰äº•ç‰©ç”£</option>
            <option value="8058 ä¸‰è±å•†äº‹">8058 ä¸‰è±å•†äº‹</option>
            <option value="9503 é–¢è¥¿é›»åŠ›">9503 é–¢è¥¿é›»åŠ›</option>
            <option value="5020 ENEOS">5020 ENEOS</option>
            <option value="5401 æ—¥æœ¬è£½é‰„">5401 æ—¥æœ¬è£½é‰„</option>
            <option value="3099 ä¸‰è¶Šä¼Šå‹¢ä¸¹">3099 ä¸‰è¶Šä¼Šå‹¢ä¸¹</option>
            <option value="7011 ä¸‰è±é‡å·¥">7011 ä¸‰è±é‡å·¥</option>
            <option value="6501 æ—¥ç«‹">6501 æ—¥ç«‹</option>
          </select>
          <div class="mini">Ctrl/âŒ˜ã§è¤‡æ•°é¸æŠã€‚ä¸»æˆ¦ãŒç„¡ã‘ã‚Œã°ç©ºã§ã‚‚OKã€‚</div>
        </div>

        <div>
          <label>ã‚¨ãƒ³ãƒˆãƒªãƒ¼å›æ•°ï¼ˆã–ã£ãã‚Šï¼‰</label>
          <select id="trades">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4+">4+</option>
          </select>

          <label style="margin-top:10px;">å„ªå‹¢ã ã£ãŸæ–¹å‘ï¼ˆä½“æ„Ÿï¼‰</label>
          <select id="bias">
            <option value="ä¸æ˜">ä¸æ˜</option>
            <option value="ãƒ­ãƒ³ã‚°">ãƒ­ãƒ³ã‚°</option>
            <option value="ã‚·ãƒ§ãƒ¼ãƒˆ">ã‚·ãƒ§ãƒ¼ãƒˆ</option>
            <option value="ä¸¡æ–¹ãƒ€ãƒ¡">ä¸¡æ–¹ãƒ€ãƒ¡</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>è² ã‘ã®ä¸»å› ï¼ˆ1ã¤ã ã‘é¸æŠï¼‰</label>
          <select id="lossCause">
            <option value="æœªå…¥åŠ›">æœªå…¥åŠ›</option>
            <option value="åœ°åˆã„æ‚ªï¼ˆæ–¹å‘å‡ºãšï¼‰">åœ°åˆã„æ‚ªï¼ˆæ–¹å‘å‡ºãšï¼‰</option>
            <option value="ãƒ–ãƒ¬ã‚¤ã‚¯ãƒ€ãƒã‚·">ãƒ–ãƒ¬ã‚¤ã‚¯ãƒ€ãƒã‚·</option>
            <option value="é€†å¼µã‚Šç™–">é€†å¼µã‚Šç™–</option>
            <option value="åˆ©ç¢ºãŒæ—©ã„">åˆ©ç¢ºãŒæ—©ã„</option>
            <option value="æåˆ‡ã‚ŠãŒé…ã„">æåˆ‡ã‚ŠãŒé…ã„</option>
            <option value="ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒæ—©ã„">ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒæ—©ã„</option>
            <option value="ãƒ­ãƒƒãƒˆãŒé‡ã„">ãƒ­ãƒƒãƒˆãŒé‡ã„</option>
            <option value="é›†ä¸­ã§ããªã„">é›†ä¸­ã§ããªã„</option>
          </select>
        </div>

        <div>
          <label>å®ˆã‚ŒãŸãƒ«ãƒ¼ãƒ«ï¼ˆ1ã¤ã ã‘ï¼‰</label>
          <select id="keptRule">
            <option value="æœªå…¥åŠ›">æœªå…¥åŠ›</option>
            <option value="æåˆ‡ã‚Šã‚’å¾¹åº•">æåˆ‡ã‚Šã‚’å¾¹åº•</option>
            <option value="ãƒ­ãƒƒãƒˆæŠ‘åˆ¶">ãƒ­ãƒƒãƒˆæŠ‘åˆ¶</option>
            <option value="è¿·ã£ãŸã‚‰è¦‹é€ã‚Š">è¿·ã£ãŸã‚‰è¦‹é€ã‚Š</option>
            <option value="1éŠ˜æŸ„é›†ä¸­">1éŠ˜æŸ„é›†ä¸­</option>
            <option value="ã‚¨ãƒ³ãƒˆãƒªãƒ¼å¾…ã¦ãŸ">ã‚¨ãƒ³ãƒˆãƒªãƒ¼å¾…ã¦ãŸ</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>ä»Šæ—¥ã®è‡ªå·±è©•ä¾¡ï¼ˆS/A/B/Cï¼‰</label>
          <select id="grade">
            <option value="æœªå…¥åŠ›">æœªå…¥åŠ›</option>
            <option value="S">Sï¼ˆå®Œç’§ï¼‰</option>
            <option value="A">Aï¼ˆè‰¯ã„ï¼‰</option>
            <option value="B">Bï¼ˆæ™®é€šï¼‰</option>
            <option value="C">Cï¼ˆæ‚ªã„ï¼‰</option>
          </select>
        </div>
        <div>
          <label>æ˜æ—¥ã®æ”¹å–„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé¸æŠï¼‰</label>
          <select id="nextAction">
            <option value="æœªå…¥åŠ›">æœªå…¥åŠ›</option>
            <option value="å¯„ã‚Š15åˆ†ã¯è§¦ã‚‰ãªã„">å¯„ã‚Š15åˆ†ã¯è§¦ã‚‰ãªã„</option>
            <option value="VWAPä»˜è¿‘ã¯è¦‹é€ã‚Š">VWAPä»˜è¿‘ã¯è¦‹é€ã‚Š</option>
            <option value="ãƒ–ãƒ¬ã‚¤ã‚¯ã¯2æœ¬ç¢ºå®šå¾Œ">ãƒ–ãƒ¬ã‚¤ã‚¯ã¯2æœ¬ç¢ºå®šå¾Œ</option>
            <option value="1æ—¥1éŠ˜æŸ„ã«çµã‚‹">1æ—¥1éŠ˜æŸ„ã«çµã‚‹</option>
            <option value="åˆå‹•200æ ªå›ºå®š">åˆå‹•200æ ªå›ºå®š</option>
            <option value="ãƒãƒ¼ãƒˆãƒ¬ã‚‚æ­£è§£ã¨ã™ã‚‹">ãƒãƒ¼ãƒˆãƒ¬ã‚‚æ­£è§£ã¨ã™ã‚‹</option>
          </select>
        </div>
      </div>

      <div>
        <label>ä¸€è¨€ãƒ¡ãƒ¢ï¼ˆä»»æ„ãƒ»çŸ­ãï¼‰</label>
        <input type="text" id="memo" maxlength="80" placeholder="ä¾‹ï¼šæ–¹å‘å‡ºãšã€‚-4000ã§æ’¤é€€ã€‚æ·±è¿½ã„ã›ãšOK" />
      </div>

      <div class="actions">
        <button id="btnSave" type="button">ä¿å­˜ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰</button>
        <button class="secondary" id="btnExportCsv" type="button">CSVæ›¸ãå‡ºã—</button>
        <button class="danger" id="btnClearAll" type="button">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
      </div>

      <div class="hint" id="autoHint">
        è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ã€Œä¿å­˜æ™‚ã«GitHubã¸ã€æ¨å¥¨ã§ã™ï¼ˆè¨­å®šã§ONï¼‰ã€‚<br/>
        è¤‡æ•°ç«¯æœ«é‹ç”¨ã¯ã€<b>å¾©å…ƒâ†’è¿½è¨˜â†’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</b> ã®é †ãŒå®‰å…¨ã§ã™ï¼ˆã“ã®HTMLã¯è‡ªå‹•ãƒãƒ¼ã‚¸ã—ã¾ã™ï¼‰ã€‚
      </div>
    </div>
  </section>

  <!-- é›†è¨ˆ -->
  <section class="card">
    <div class="hd">
      <div class="pill">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
      <div class="pill" id="countLabel">0ä»¶</div>
    </div>
    <div class="bd">
      <div class="kpi">
        <div class="box">
          <div class="t">ä»Šæœˆ æç›Šåˆè¨ˆ</div>
          <div class="v" id="kpiMonthPnl">0</div>
        </div>
        <div class="box">
          <div class="t">å‹ç‡ï¼ˆå‹ã¡/(å‹ã¡+è² ã‘)ï¼‰</div>
          <div class="v" id="kpiWinRate">â€”</div>
        </div>
        <div class="box">
          <div class="t">ãƒãƒ¼ãƒˆãƒ¬ç‡</div>
          <div class="v" id="kpiNoTrade">â€”</div>
        </div>
        <div class="box">
          <div class="t">æœ€å¤šã®è² ã‘ä¸»å› </div>
          <div class="v" id="kpiTopCause" style="font-size:14px;">â€”</div>
        </div>
      </div>

      <div style="margin-top:14px;">
        <table class="tbl">
          <thead>
            <tr>
              <th style="width:95px;">æ—¥ä»˜</th>
              <th style="width:70px;">çµæœ</th>
              <th style="width:90px;">æç›Š</th>
              <th>è¦ç´„</th>
              <th style="width:90px;">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
    </div>
  </section>

</main>

<!-- GitHub settings modal -->
<div class="modal-bg" id="modalBg" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="GitHubè¨­å®š">
    <div class="hd">
      <div class="pill">GitHubè¨­å®šï¼ˆ1å›ã ã‘ï¼‰</div>
      <div class="right">
        <button class="secondary small" id="btnTest" type="button">æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
        <button class="secondary small" id="btnCloseModal" type="button">é–‰ã˜ã‚‹</button>
      </div>
    </div>
    <div class="bd">
      <div class="status" id="ghStatus">
        <span class="dot" id="statusDot"></span>
        <span id="statusText">æœªè¨­å®š</span>
      </div>

      <div class="row" style="margin-top:12px;">
        <div>
          <label>ownerï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼‰</label>
          <input id="ghOwner" type="text" placeholder="ä¾‹ï¼šshinoda-y" />
        </div>
        <div>
          <label>repoï¼ˆãƒªãƒã‚¸ãƒˆãƒªåï¼‰</label>
          <input id="ghRepo" type="text" placeholder="ä¾‹ï¼štrade-diary" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>branch</label>
          <input id="ghBranch" type="text" placeholder="main" />
        </div>
        <div>
          <label>pathï¼ˆä¿å­˜å…ˆï¼‰</label>
          <input id="ghPath" type="text" placeholder="data/diary.json" />
          <div class="mini">ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã€‚å­˜åœ¨ã—ãªãã¦ã‚‚OKï¼ˆåˆå›ã¯ä½œæˆã—ã¾ã™ï¼‰ã€‚</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>tokenï¼ˆFine-grained PAT / Contents RWï¼‰</label>
          <input id="ghToken" type="text" placeholder="github_pat_..." />
          <div class="mini">
            æ³¨æ„ï¼šã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆlocalStorageï¼‰ã«ä¿å­˜ã—ã¾ã™ã€‚<br/>
            å…¬é–‹ãƒªãƒã‚¸ãƒˆãƒªã«ã“ã®HTMLã‚’ç½®ãé‹ç”¨ã¯é¿ã‘ã¦ãã ã•ã„ã€‚
          </div>
        </div>
        <div>
          <label>è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</label>
          <select id="autoMode">
            <option value="off">OFF</option>
            <option value="onsave">ä¿å­˜æ™‚ã«GitHubã¸ï¼ˆæ¨å¥¨ï¼‰</option>
            <option value="interval">nåˆ†ã”ã¨ï¼ˆãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦ã„ã‚‹é–“ï¼‰</option>
            <option value="both">ä¿å­˜æ™‚ + nåˆ†ã”ã¨</option>
          </select>

          <label style="margin-top:10px;">nåˆ†ï¼ˆintervalç”¨ï¼‰</label>
          <select id="autoMinutes">
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="15" selected>15</option>
            <option value="30">30</option>
            <option value="60">60</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button id="btnSaveGh" type="button">è¨­å®šã‚’ä¿å­˜</button>
        <button class="secondary" id="btnClearGh" type="button">GitHubè¨­å®šã‚’å‰Šé™¤</button>
      </div>

      <div class="hint">
        è¤‡æ•°ç«¯æœ«é‹ç”¨ã®å‹ï¼š<b>â‘ å¾©å…ƒ â†’ â‘¡è¨˜éŒ² â†’ â‘¢ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</b><br/>
        ãŸã ã—æœ¬HTMLã¯ <b>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—/å¾©å…ƒã®ã©ã¡ã‚‰ã§ã‚‚ãƒãƒ¼ã‚¸</b> ã™ã‚‹ãŸã‚ã€äº‹æ•…ç‡ã¯ä½ã„ã§ã™ã€‚
      </div>
    </div>
  </div>
</div>

<script>
  // -------------------------
  // Storage keys
  // -------------------------
  const KEY = "tradeDiary_v1";      // entries array
  const GHKEY = "tradeDiary_github"; // github config

  const $ = (id) => document.getElementById(id);

  const els = {
    date: $("date"),
    marketType: $("marketType"),
    result: $("result"),
    pnl: $("pnl"),
    tickers: $("tickers"),
    trades: $("trades"),
    bias: $("bias"),
    lossCause: $("lossCause"),
    keptRule: $("keptRule"),
    grade: $("grade"),
    nextAction: $("nextAction"),
    memo: $("memo"),
  };

  const ui = {
    todayLabel: $("todayLabel"),
    ghLabel: $("ghLabel"),
    countLabel: $("countLabel"),
    rows: $("rows"),
    kpiMonthPnl: $("kpiMonthPnl"),
    kpiWinRate: $("kpiWinRate"),
    kpiNoTrade: $("kpiNoTrade"),
    kpiTopCause: $("kpiTopCause"),
    autoHint: $("autoHint"),
  };

  // modal
  const modalBg = $("modalBg");
  const ghStatusDot = $("statusDot");
  const ghStatusText = $("statusText");
  const ghOwner = $("ghOwner");
  const ghRepo = $("ghRepo");
  const ghBranch = $("ghBranch");
  const ghPath = $("ghPath");
  const ghToken = $("ghToken");
  const autoMode = $("autoMode");
  const autoMinutes = $("autoMinutes");

  // auto backup timer
  let autoTimer = null;

  function todayISO(){
    const d = new Date();
    const tz = new Date(d.getTime() - d.getTimezoneOffset()*60000);
    return tz.toISOString().slice(0,10);
  }

  function loadAll(){
    try { return JSON.parse(localStorage.getItem(KEY) || "[]"); }
    catch(e){ return []; }
  }
  function saveAll(rows){
    localStorage.setItem(KEY, JSON.stringify(rows));
  }

  function getSelectedOptions(selectEl){
    return Array.from(selectEl.selectedOptions).map(o => o.value);
  }
  function setSelectedOptions(selectEl, values){
    const set = new Set(values || []);
    Array.from(selectEl.options).forEach(o => o.selected = set.has(o.value));
  }

  function formToEntry(){
    return {
      date: els.date.value || todayISO(),
      marketType: els.marketType.value,
      result: els.result.value,
      pnl: els.pnl.value === "" ? null : Number(els.pnl.value),
      tickers: getSelectedOptions(els.tickers),
      trades: els.trades.value,
      bias: els.bias.value,
      lossCause: els.lossCause.value,
      keptRule: els.keptRule.value,
      grade: els.grade.value,
      nextAction: els.nextAction.value,
      memo: (els.memo.value || "").trim(),
      updatedAt: new Date().toISOString(),
    };
  }

  function entryToForm(e){
    els.date.value = e.date || todayISO();
    els.marketType.value = e.marketType || "ä¸æ˜";
    els.result.value = e.result || "æœªå…¥åŠ›";
    els.pnl.value = (e.pnl === null || e.pnl === undefined) ? "" : String(e.pnl);
    setSelectedOptions(els.tickers, e.tickers || []);
    els.trades.value = e.trades || "0";
    els.bias.value = e.bias || "ä¸æ˜";
    els.lossCause.value = e.lossCause || "æœªå…¥åŠ›";
    els.keptRule.value = e.keptRule || "æœªå…¥åŠ›";
    els.grade.value = e.grade || "æœªå…¥åŠ›";
    els.nextAction.value = e.nextAction || "æœªå…¥åŠ›";
    els.memo.value = e.memo || "";
  }

  function upsertEntry(entry){
    const all = loadAll();
    const idx = all.findIndex(x => x.date === entry.date);
    if(idx >= 0) all[idx] = entry;
    else all.push(entry);
    all.sort((a,b)=> a.date.localeCompare(b.date));
    saveAll(all);
  }

  function deleteEntry(date){
    const all = loadAll().filter(x => x.date !== date);
    saveAll(all);
  }

  function clearAll(){
    localStorage.removeItem(KEY);
  }

  function fmtYen(n){
    if(n === null || n === undefined) return "â€”";
    const sign = n > 0 ? "+" : "";
    return sign + n.toLocaleString("ja-JP");
  }

  function tagForResult(result){
    if(result === "å‹ã¡") return `<span class="tag good">å‹ã¡</span>`;
    if(result === "è² ã‘") return `<span class="tag bad">è² ã‘</span>`;
    if(result === "ãƒˆãƒ³ãƒˆãƒ³") return `<span class="tag warn">ãƒˆãƒ³ãƒˆãƒ³</span>`;
    if(result === "ãƒãƒ¼ãƒˆãƒ¬") return `<span class="tag">ãƒãƒ¼ãƒˆãƒ¬</span>`;
    return `<span class="tag">æœªå…¥åŠ›</span>`;
  }

  function buildSummary(e){
    const t = (e.tickers && e.tickers.length) ? e.tickers.join(" / ") : "â€”";
    const parts = [
      `${t}`,
      `ç›¸å ´:${e.marketType || "â€”"}`,
      `æ–¹å‘:${e.bias || "â€”"}`,
      `åŸå› :${e.lossCause || "â€”"}`,
      `æ˜æ—¥:${e.nextAction || "â€”"}`,
    ];
    const memo = e.memo ? `ï¼ãƒ¡ãƒ¢:${e.memo}` : "";
    return parts.join(" | ") + memo;
  }

  function render(){
    const all = loadAll();
    ui.countLabel.textContent = `${all.length}ä»¶`;
    ui.todayLabel.textContent = `ä»Šæ—¥: ${els.date.value || todayISO()}`;

    // KPIï¼ˆä»Šæœˆï¼‰
    const now = new Date();
    const ym = now.toISOString().slice(0,7); // YYYY-MM
    const thisMonth = all.filter(x => (x.date || "").startsWith(ym));
    const monthPnl = thisMonth.reduce((acc,x)=> acc + (Number.isFinite(x.pnl) ? x.pnl : 0), 0);

    ui.kpiMonthPnl.textContent = fmtYen(monthPnl);
    ui.kpiMonthPnl.className = "v " + (monthPnl>0 ? "good" : (monthPnl<0 ? "bad" : ""));

    // å‹ç‡
    const wins = thisMonth.filter(x => x.result==="å‹ã¡").length;
    const losses = thisMonth.filter(x => x.result==="è² ã‘").length;
    ui.kpiWinRate.textContent = (wins+losses)>0 ? `${Math.round((wins/(wins+losses))*100)}%` : "â€”";

    // ãƒãƒ¼ãƒˆãƒ¬ç‡
    const nt = thisMonth.filter(x => x.result==="ãƒãƒ¼ãƒˆãƒ¬").length;
    ui.kpiNoTrade.textContent = thisMonth.length>0 ? `${Math.round((nt/thisMonth.length)*100)}%` : "â€”";

    // æœ€å¤šåŸå› 
    const counts = new Map();
    thisMonth.forEach(x=>{
      const c = x.lossCause || "æœªå…¥åŠ›";
      if(c==="æœªå…¥åŠ›") return;
      counts.set(c,(counts.get(c)||0)+1);
    });
    let top = "â€”", topN = 0;
    counts.forEach((v,k)=>{ if(v>topN){ topN=v; top=k; }});
    ui.kpiTopCause.textContent = top;

    // Rows
    ui.rows.innerHTML = "";
    all.slice().reverse().forEach(e=>{
      const tr = document.createElement("tr");
      const pnlClass = Number.isFinite(e.pnl) ? (e.pnl>0 ? "good" : (e.pnl<0 ? "bad" : "")) : "";
      tr.innerHTML = `
        <td>${e.date || "â€”"}</td>
        <td>${tagForResult(e.result)}</td>
        <td><span class="${pnlClass}">${fmtYen(e.pnl)}</span></td>
        <td>${buildSummary(e)}</td>
        <td>
          <button class="secondary small" data-act="edit" data-date="${e.date}" type="button">ç·¨é›†</button>
          <button class="danger small" data-act="del" data-date="${e.date}" type="button" style="margin-left:6px;">å‰Šé™¤</button>
        </td>
      `;
      ui.rows.appendChild(tr);
    });

    updateGitHubLabel();
    updateAutoHint();
  }

  function exportCSV(){
    const all = loadAll();
    const header = [
      "date","marketType","result","pnl","tickers","trades","bias","lossCause","keptRule","grade","nextAction","memo","updatedAt"
    ];
    const esc = (s) => {
      if(s===null || s===undefined) return "";
      const str = String(s).replaceAll('"','""');
      return `"${str}"`;
    };
    const lines = [header.join(",")];
    all.forEach(e=>{
      const row = [
        e.date,
        e.marketType,
        e.result,
        (Number.isFinite(e.pnl) ? e.pnl : ""),
        (e.tickers || []).join(" / "),
        e.trades,
        e.bias,
        e.lossCause,
        e.keptRule,
        e.grade,
        e.nextAction,
        e.memo,
        e.updatedAt
      ].map(esc).join(",");
      lines.push(row);
    });

    const blob = new Blob([lines.join("\n")], {type:"text/csv;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "trade-diary.csv";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  // -------------------------
  // GitHub config
  // -------------------------
  function loadGH(){
    try{
      return JSON.parse(localStorage.getItem(GHKEY) || "null");
    }catch(e){ return null; }
  }
  function saveGH(cfg){
    localStorage.setItem(GHKEY, JSON.stringify(cfg));
  }
  function clearGH(){
    localStorage.removeItem(GHKEY);
  }

  function isGHReady(cfg){
    return cfg && cfg.owner && cfg.repo && cfg.branch && cfg.path && cfg.token;
  }

  function updateGitHubLabel(){
    const cfg = loadGH();
    if(!isGHReady(cfg)){
      ui.ghLabel.textContent = "GitHub: æœªè¨­å®š";
      return;
    }
    ui.ghLabel.textContent = `GitHub: ${cfg.owner}/${cfg.repo}@${cfg.branch} (${cfg.path})`;
  }

  function setStatus(ok, text){
    ghStatusDot.className = "dot" + (ok ? " ok" : " ng");
    ghStatusText.textContent = text;
  }

  function openModal(){
    const cfg = loadGH() || {
      owner:"", repo:"", branch:"main", path:"data/diary.json", token:"",
      autoMode:"onsave", autoMinutes:"15"
    };
    ghOwner.value = cfg.owner || "";
    ghRepo.value = cfg.repo || "";
    ghBranch.value = cfg.branch || "main";
    ghPath.value = cfg.path || "data/diary.json";
    ghToken.value = cfg.token || "";
    autoMode.value = cfg.autoMode || "onsave";
    autoMinutes.value = cfg.autoMinutes || "15";

    setStatus(isGHReady(cfg), isGHReady(cfg) ? "è¨­å®šæ¸ˆã¿" : "æœªè¨­å®šï¼ˆowner/repo/path/token ã‚’å…¥åŠ›ï¼‰");
    modalBg.style.display = "flex";
    modalBg.setAttribute("aria-hidden","false");
  }

  function closeModal(){
    modalBg.style.display = "none";
    modalBg.setAttribute("aria-hidden","true");
  }

  function ghApiHeaders(cfg){
    return {
      "Authorization": `token ${cfg.token}`,
      "Accept": "application/vnd.github+json",
      "Content-Type": "application/json",
    };
  }

  function b64encodeUnicode(str){
    // UTF-8 safe base64
    return btoa(unescape(encodeURIComponent(str)));
  }
  function b64decodeUnicode(b64){
    return decodeURIComponent(escape(atob(b64)));
  }

  async function ghGetFile(cfg){
    const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${cfg.path}?ref=${encodeURIComponent(cfg.branch)}`;
    const res = await fetch(url, { headers: ghApiHeaders(cfg) });
    if(res.status === 404) return { exists:false, sha:null, data:null };
    if(!res.ok){
      const txt = await res.text();
      throw new Error(`GitHub GET failed: ${res.status} ${txt}`);
    }
    const json = await res.json();
    const content = json.content ? b64decodeUnicode(json.content.replaceAll("\n","")) : null;
    let data = null;
    try{ data = content ? JSON.parse(content) : null; }catch(e){ data = null; }
    return { exists:true, sha:json.sha, data };
  }

  function normalizeEntries(arr){
    if(!Array.isArray(arr)) return [];
    return arr
      .filter(x => x && x.date)
      .map(x => ({
        ...x,
        updatedAt: x.updatedAt || new Date(0).toISOString(),
      }));
  }

  function mergeEntries(localArr, remoteArr){
    const l = normalizeEntries(localArr);
    const r = normalizeEntries(remoteArr);
    const map = new Map();

    // put older first, then overwrite by updatedAt logic
    for(const e of [...l, ...r]){
      const prev = map.get(e.date);
      if(!prev){
        map.set(e.date, e);
        continue;
      }
      const a = new Date(prev.updatedAt).getTime();
      const b = new Date(e.updatedAt).getTime();
      if(b >= a) map.set(e.date, e);
    }

    const out = Array.from(map.values()).sort((a,b)=> a.date.localeCompare(b.date));
    return out;
  }

  async function ghPutFile(cfg, mergedEntries, sha){
    const url = `https://api.github.com/repos/${cfg.owner}/${cfg.repo}/contents/${cfg.path}`;
    const body = {
      message: `trade diary backup ${new Date().toISOString()}`,
      content: b64encodeUnicode(JSON.stringify(mergedEntries, null, 2)),
      branch: cfg.branch,
      ...(sha ? { sha } : {}),
    };
    const res = await fetch(url, { method:"PUT", headers: ghApiHeaders(cfg), body: JSON.stringify(body) });
    if(!res.ok){
      const txt = await res.text();
      throw new Error(`GitHub PUT failed: ${res.status} ${txt}`);
    }
    return await res.json();
  }

  async function githubBackupWithMerge(){
    const cfg = loadGH();
    if(!isGHReady(cfg)) throw new Error("GitHubè¨­å®šãŒæœªå®Œäº†ã§ã™ï¼ˆè¨­å®šâ†’ä¿å­˜â†’æ¥ç¶šãƒ†ã‚¹ãƒˆï¼‰ã€‚");

    // remote
    const remote = await ghGetFile(cfg);
    const local = loadAll();
    const merged = mergeEntries(local, remote.data);

    // push merged
    await ghPutFile(cfg, merged, remote.sha);

    // also update local to merged to ensure consistency
    saveAll(merged);
    render();
  }

  async function githubRestoreWithMerge(){
    const cfg = loadGH();
    if(!isGHReady(cfg)) throw new Error("GitHubè¨­å®šãŒæœªå®Œäº†ã§ã™ï¼ˆè¨­å®šâ†’ä¿å­˜â†’æ¥ç¶šãƒ†ã‚¹ãƒˆï¼‰ã€‚");

    const remote = await ghGetFile(cfg);
    const local = loadAll();
    const merged = mergeEntries(local, remote.data);

    // write merged to local
    saveAll(merged);
    render();
  }

  async function githubTest(){
    const cfg = loadGH();
    if(!isGHReady(cfg)) throw new Error("GitHubè¨­å®šãŒæœªå®Œäº†ã§ã™ï¼ˆowner/repo/branch/path/tokenï¼‰ã€‚");
    await ghGetFile(cfg); // existence is ok
    return true;
  }

  function updateAutoHint(){
    const cfg = loadGH();
    if(!cfg || !cfg.autoMode || cfg.autoMode==="off"){
      ui.autoHint.innerHTML = `è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼š<b>OFF</b>ï¼ˆè¨­å®šã§ONå¯èƒ½ï¼‰ã€‚<br/>è¤‡æ•°ç«¯æœ«ã¯ <b>å¾©å…ƒâ†’è¿½è¨˜â†’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</b> ãŒå®‰å…¨ã§ã™ï¼ˆæœ¬HTMLã¯è‡ªå‹•ãƒãƒ¼ã‚¸ï¼‰ã€‚`;
      return;
    }
    if(cfg.autoMode==="onsave"){
      ui.autoHint.innerHTML = `è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼š<b>ä¿å­˜æ™‚ã«GitHubã¸</b>ï¼ˆæ¨å¥¨ï¼‰ã€‚<br/>è¤‡æ•°ç«¯æœ«ã§ã‚‚ <b>updatedAt</b> ã§ãƒãƒ¼ã‚¸ã—ã¾ã™ã€‚`;
      return;
    }
    if(cfg.autoMode==="interval"){
      ui.autoHint.innerHTML = `è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼š<b>${cfg.autoMinutes}åˆ†ã”ã¨</b>ï¼ˆãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦ã„ã‚‹é–“ï¼‰ã€‚<br/>å®‰å…¨æ€§ã®ãŸã‚å¾©å…ƒã‚‚é©å®œè¡Œã£ã¦ãã ã•ã„ï¼ˆæœ¬HTMLã¯ãƒãƒ¼ã‚¸ï¼‰ã€‚`;
      return;
    }
    ui.autoHint.innerHTML = `è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼š<b>ä¿å­˜æ™‚ + ${cfg.autoMinutes}åˆ†ã”ã¨</b>ã€‚<br/>è¤‡æ•°ç«¯æœ«ã§ã‚‚ãƒãƒ¼ã‚¸ï¼ˆupdatedAtå„ªå…ˆï¼‰ã§è¡çªå›é¿ã—ã¾ã™ã€‚`;
  }

  function stopAutoTimer(){
    if(autoTimer){ clearInterval(autoTimer); autoTimer = null; }
  }

  function startAutoTimerIfNeeded(){
    stopAutoTimer();
    const cfg = loadGH();
    if(!isGHReady(cfg)) return;
    if(cfg.autoMode !== "interval" && cfg.autoMode !== "both") return;

    const mins = Number(cfg.autoMinutes || 15);
    const ms = Math.max(1, mins) * 60 * 1000;

    autoTimer = setInterval(async ()=>{
      try{
        await githubBackupWithMerge();
        console.log("Auto backup OK");
      }catch(e){
        console.warn("Auto backup failed", e);
      }
    }, ms);
  }

  async function maybeAutoBackupOnSave(){
    const cfg = loadGH();
    if(!isGHReady(cfg)) return;
    if(cfg.autoMode !== "onsave" && cfg.autoMode !== "both") return;
    await githubBackupWithMerge();
  }

  // -------------------------
  // Event bindings
  // -------------------------
  // init
  els.date.value = todayISO();

  $("btnSave").addEventListener("click", async ()=>{
    const e = formToEntry();
    upsertEntry(e);
    render();

    // Auto backup on save if configured
    try{
      await maybeAutoBackupOnSave();
      alert("ä¿å­˜ã—ã¾ã—ãŸã€‚" + (loadGH()?.autoMode==="onsave" || loadGH()?.autoMode==="both" ? "ï¼ˆGitHubã¸ã‚‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¸ˆã¿ï¼‰" : ""));
    }catch(err){
      alert("ä¿å­˜ã¯å®Œäº†ã—ã¾ã—ãŸãŒã€GitHubãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n" + err.message);
    }
  });

  $("btnLoadToday").addEventListener("click", ()=>{
    const d = els.date.value || todayISO();
    const all = loadAll();
    const found = all.find(x => x.date === d);
    if(!found){
      alert("ä»Šæ—¥ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚");
      return;
    }
    entryToForm(found);
    render();
  });

  $("btnResetForm").addEventListener("click", ()=>{
    entryToForm({
      date: todayISO(),
      marketType:"ä¸æ˜",
      result:"æœªå…¥åŠ›",
      pnl:null,
      tickers:[],
      trades:"0",
      bias:"ä¸æ˜",
      lossCause:"æœªå…¥åŠ›",
      keptRule:"æœªå…¥åŠ›",
      grade:"æœªå…¥åŠ›",
      nextAction:"æœªå…¥åŠ›",
      memo:""
    });
    render();
  });

  $("btnExportCsv").addEventListener("click", exportCSV);

  $("btnClearAll").addEventListener("click", ()=>{
    if(confirm("å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã€‚æœ¬å½“ã«è‰¯ã„ã§ã™ã‹ï¼Ÿ")){
      clearAll();
      render();
      alert("å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
    }
  });

  ui.rows.addEventListener("click", (ev)=>{
    const btn = ev.target.closest("button");
    if(!btn) return;
    const act = btn.dataset.act;
    const date = btn.dataset.date;
    if(act === "edit"){
      const all = loadAll();
      const found = all.find(x => x.date === date);
      if(found){
        entryToForm(found);
        render();
        window.scrollTo({top:0, behavior:"smooth"});
      }
    }
    if(act === "del"){
      if(confirm(`${date} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)){
        deleteEntry(date);
        render();
      }
    }
  });

  // GitHub buttons
  $("btnGitHub").addEventListener("click", openModal);
  $("btnCloseModal").addEventListener("click", closeModal);
  modalBg.addEventListener("click", (e)=>{ if(e.target === modalBg) closeModal(); });

  $("btnSaveGh").addEventListener("click", ()=>{
    const cfg = {
      owner: ghOwner.value.trim(),
      repo: ghRepo.value.trim(),
      branch: (ghBranch.value.trim() || "main"),
      path: (ghPath.value.trim() || "data/diary.json"),
      token: ghToken.value.trim(),
      autoMode: autoMode.value,
      autoMinutes: autoMinutes.value,
    };
    saveGH(cfg);
    setStatus(isGHReady(cfg), isGHReady(cfg) ? "è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ" : "ä¿å­˜ã—ã¾ã—ãŸãŒæœªå®Œäº†ï¼ˆtokenç­‰ã‚’ç¢ºèªï¼‰");
    updateGitHubLabel();
    updateAutoHint();
    startAutoTimerIfNeeded();
    alert("GitHubè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");
  });

  $("btnClearGh").addEventListener("click", ()=>{
    if(confirm("GitHubè¨­å®šï¼ˆãƒˆãƒ¼ã‚¯ãƒ³å«ã‚€ï¼‰ã‚’ã“ã®ç«¯æœ«ã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
      clearGH();
      setStatus(false, "å‰Šé™¤ã—ã¾ã—ãŸ");
      updateGitHubLabel();
      updateAutoHint();
      stopAutoTimer();
    }
  });

  $("btnTest").addEventListener("click", async ()=>{
    try{
      const cfg = {
        owner: ghOwner.value.trim(),
        repo: ghRepo.value.trim(),
        branch: (ghBranch.value.trim() || "main"),
        path: (ghPath.value.trim() || "data/diary.json"),
        token: ghToken.value.trim(),
        autoMode: autoMode.value,
        autoMinutes: autoMinutes.value,
      };
      saveGH(cfg);
      await githubTest();
      setStatus(true, "æ¥ç¶šOKï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãŒç„¡ãã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ï¼‰");
      updateGitHubLabel();
      startAutoTimerIfNeeded();
      alert("æ¥ç¶šOKã§ã™ã€‚");
    }catch(e){
      setStatus(false, "æ¥ç¶šNGï¼š" + e.message);
      alert("æ¥ç¶šNGï¼š\n" + e.message);
    }
  });

  $("btnBackup").addEventListener("click", async ()=>{
    try{
      await githubBackupWithMerge();
      alert("GitHubã¸ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†ï¼ˆãƒãƒ¼ã‚¸æ¸ˆã¿ï¼‰ã€‚");
    }catch(e){
      alert("ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•—ï¼š\n" + e.message);
    }
  });

  $("btnRestore").addEventListener("click", async ()=>{
    try{
      await githubRestoreWithMerge();
      alert("GitHubã‹ã‚‰å¾©å…ƒå®Œäº†ï¼ˆãƒãƒ¼ã‚¸æ¸ˆã¿ï¼‰ã€‚");
    }catch(e){
      alert("å¾©å…ƒå¤±æ•—ï¼š\n" + e.message);
    }
  });

  // start
  render();
  startAutoTimerIfNeeded();
</script>
</body>
</html>
